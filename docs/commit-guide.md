# 커밋 규칙 가이드

이 문서는 레포지토리 변경을 안전하고 일관되게 기록하기 위한 절차와 커밋 메시지 규칙을 정의합니다. 작업 전후로 아래 항목을 반드시 점검해 주세요.

## 기본 원칙

- 커밋 메시지는 Conventional Commits 형식을 한국어 요약으로 작성합니다.
- 모든 명령은 `pnpm`을 기준으로 실행합니다.
- 사전 설치된 Lefthook `pre-commit` 훅이 항상 실행되도록 유지합니다. 필요 시 `pnpm lefthook run pre-commit`으로 수동 확인합니다.

## 커밋 준비 체크리스트

1. **변경 범위 정리**: 하나의 주제(기능 추가, 버그 수정 등)에 집중해 커밋 크기를 관리합니다.
2. **포맷/린트 실행**: `pnpm format`, `pnpm lint` 순으로 실행해 Biome 규칙을 만족합니다. Lefthook 훅도 동일 명령을 자동 실행하므로, 선행 실행으로 실패 여부를 미리 확인합니다.
3. **테스트 확인**: 향후 테스트 스크립트가 추가될 것을 대비해 관련 명령을 실행합니다. 자동화가 없다면 수동 점검 결과를 작업 로그에 남깁니다.
4. **로그 갱신**: 필요한 경우 `logs/` 폴더의 월별 `.jsonl` 파일에 세션 기록을 append 합니다.
5. **작업 내용 검토**: `git status`, `git diff`로 변경 파일을 확인해 불필요한 수정이 포함되지 않았는지 확인합니다.
6. **훅 검증(Optional)**: 문제 상황을 대비해 `pnpm lefthook run pre-commit`으로 훅을 수동 실행해도 됩니다.

## 커밋 타입 정의

| 타입 | 사용 시점 | 예시 | 비고 |
| --- | --- | --- | --- |
| **feat** | 사용자에게 보이는 새 기능 추가 | `feat: 태그 필터 기능 추가` | API 변경이 있다면 본문에 명시 |
| **fix** | 버그 수정, 회귀 해결 | `fix: 다크 모드 텍스트 색상 복구` | 원인과 테스트 결과를 본문에 요약 |
| **docs** | 문서, README, 주석 보완 | `docs: 프로젝트 규칙 한글화` | 주석/가이드 변경 포함 |
| **refactor** | 기능 변화 없이 내부 구조 개선 | `refactor: 포스트 정렬 로직 단순화` | 동작 변화가 있다면 `feat`/`fix` 사용 |
| **style** | 코드 포맷팅, 공백, 세미콜론 등 | `style: Biome 자동 포맷 적용` | 로직 변경이 없어야 함 |
| **test** | 테스트 코드 추가·수정 | `test: 필터 유닛 테스트 보강` | 실패 테스트 수정은 `fix`와 병행 고려 |
| **build** | 빌드/배포 설정 변경 | `build: Vercel 환경 변수 추가` | 빌드 툴, 패키지 업데이트 포함 |
| **chore** | 유지보수 작업, 의존성 업데이트 | `chore: pnpm-lock.yaml 재생성` | 사용자 영향이 거의 없는 작업 |
| **perf** | 성능 최적화 | `perf: 이미지 lazyload 임계값 조정` | 성능 개선 근거를 본문에 기록 |
| **ci** | CI 파이프라인 수정 | `ci: 테스트 워크플로 캐시 최적화` | 로컬 빌드와 구분 |
| **revert** | 이전 커밋 되돌리기 | `revert: feat: 태그 필터 기능 추가` | 본문에 원본 커밋 해시 기입 |

타입이 모호하다면 위 표에서 가장 가까운 항목을 선택하고, 정말 필요할 때만 새 타입을 정의합니다.

## 커밋 메시지 작성 규칙

- 기본 형식: `타입(선택적 스코프): 한 줄 요약`
- 요약은 한국어로 작성하며, 필요한 기술 용어는 영어 그대로 사용합니다.
- 본문에는 변경 이유, 테스트 결과, 관련 로그 위치를 `-` bullet 형태로 정리합니다.
- 관련 이슈나 참고 항목이 있다면 마지막 줄에 `Refs:` 또는 `Resolves:`로 링크합니다.

### 예시 메시지

```
feat: 블로그 포스트 상세 페이지 초안 추가

- API mock 데이터로 렌더링 동작 확인
- logs/2024-05.jsonl 업데이트
```

## 커밋 단위와 브랜치 전략

- `main` 브랜치는 항상 배포 가능한 상태를 유지합니다.
- 새로운 작업은 기능 브랜치(`feature/...`, `fix/...`)에서 진행하고, 완료 후 PR 또는 fast-forward 병합으로 `main`에 반영합니다.
- 리뷰가 필요하면 관련 규칙을 `PROJECT_RULES.md`와 함께 공유합니다.

## Lefthook 도입 가이드

Lefthook은 Git hook 관리 도구로, 커밋 전에 포맷/린트 등을 자동 실행해 규칙 위반을 방지합니다.

| 항목 | 장점 | 고려 사항 |
| --- | --- | --- |
| **사전 커밋 자동화** | `pnpm format`, `pnpm lint`를 자동 실행해 규칙 미준수로 인한 커밋 실패를 줄입니다. | 초기 설정을 위한 `lefthook.yml` 작성과 패키지 설치가 필요합니다. |
| **일관성 확보** | AI 어시스턴트와 사용자가 동일한 규칙을 강제할 수 있습니다. | 훅 실패 시 커밋이 차단되므로 비상 시 우회 방법(`LEFTHOOK=0`)을 숙지해야 합니다. |
| **속도 유지** | Biome 기반 포맷/린트는 빠른 편이라 지연이 크지 않습니다. | 대규모 변경 시 시간이 오래 걸리면 부분 커밋으로 나누는 것이 좋습니다. |

### 도입 절차

1. `pnpm add -D lefthook`
2. `pnpm lefthook install` 또는 `npx lefthook install`
3. 루트에 `lefthook.yml` 작성:
   ```yml
   pre-commit:
     parallel: true
     commands:
       format:
         run: pnpm format
       lint:
         run: pnpm lint
   ```
4. 필요하면 `pre-push` 훅에 테스트 명령을 추가합니다.

도입 후 훅을 임시로 비활성화하려면 `LEFTHOOK=0 git commit ...` 형태로 커맨드를 실행합니다.

### 운영 팁

- `pnpm lefthook run pre-commit --files "<경로>"`를 사용하면 특정 파일만 대상으로 훅을 테스트할 수 있습니다.
- 스테이징된 파일이 없으면 `skip` 메시지가 출력되므로, 변경 사항이 있는지 다시 확인해 주세요.
